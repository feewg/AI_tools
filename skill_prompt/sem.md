# SEM 图示通用规范（LaTeX / TikZ）
Structural Equation Modeling – Visual Grammar & Prefab Blocks

---

## 1. SEM 图的“语法规则”（Visual Grammar）

SEM 图不是随便画的，而是一套**约定俗成的图形语言**。  
这一节定义：**每种形状 = 什么变量，每种线 = 什么统计含义**。

---

## 2. 变量类型与图形表示

### 2.1 潜变量（Latent Variable）
- **图形**：椭圆（Ellipse）
- **含义**：不可直接观测的构念 / 因子
- **常见记号**：
  - 一般 SEM：`η`（内生）、`ξ`（外生）
  - CFA / 心理测量：`F1`, `F2`
  - 增长模型：`i`（截距）、`s`（斜率）
- **TikZ 样式**：`latent`

---

### 2.2 观测变量（Observed / Manifest Variable）
- **图形**：矩形（Rectangle）
- **含义**：题项、指标、测量值
- **常见记号**：
  - 连续指标：`y1`, `y2`
  - 问卷题项：`item1`
  - 时间序列：`y_t`
- **TikZ 样式**：`manifest`

---

### 2.3 误差 / 残差 / 扰动项
- **图形**：小圆（Circle）
- **类型区分**：
  - 指标测量误差：`ε` (epsilon)
  - 内生潜变量扰动：`ζ` (zeta)
- **语义**：未被模型解释的变异
- **TikZ 样式**：`error`

---

### 2.4 常数 / 截距 / 均值结构
- **图形**：三角形 或 标注为 `1`
- **含义**：
  - 均值结构（Mean structure）
  - 截距（Intercept）
- **TikZ 样式**：`const`

---

## 3. 路径类型与统计含义

### 3.1 单向箭头 `A → B`
- **含义**：
  - 回归路径（Regression）
  - 因子载荷（Factor loading）
  - 自回归路径（Lagged effect）
- **使用场景**：
  - 潜变量 → 指标
  - 自变量 → 因变量
- **TikZ 样式**：`reg`

---

### 3.2 双向箭头 `A ↔ B`
- **含义**：
  - 协方差 / 相关
- **使用场景**：
  - 外生变量之间
  - 误差项相关（Correlated residuals）
- **TikZ 样式**：`cov`

---

### 3.3 自回路 `A ↔ A`
- **含义**：方差（Variance）
- **实践中**：
  - 常被“误差圆 → 变量”替代
  - 语义更清晰：**残差导致变量的未解释部分**

---

### 3.4 虚线路径
- **含义（约定）**：
  - 固定参数（fixed）
  - 约束参数（equality constraint）
- ⚠️ **注意**：  
  图中虚线只是“标记”，真正固定必须在模型语法（如 Mplus）中完成。

---

## 4. SEM 图的一般排版原则（Layout）

- **测量模型（CFA）**
  - 潜变量在上
  - 指标在下
- **结构模型（SEM）**
  - 外生变量在左
  - 内生变量在右
- **中介模型**
  - 中介变量居中
- **纵向模型**
  - 时间从左 → 右 或 上 → 下
- **误差项**
  - 放在对应变量旁边
- **协方差**
  - 使用 `bend left/right` 避免线条交叉

---

## 5. SEM 预制块（Prefab Blocks）

下面列出**所有常见 SEM 结构的“积木块”**，可以单独使用，也可以拼装。

---

### 5.1 单因子 CFA（Single-Factor CFA）
**结构**：
- 一个潜变量 → 多个指标
- 每个指标一个测量误差

**用途**：
- 信度与结构效度检验
- 问卷验证

---

### 5.2 多因子 CFA（Multi-Factor CFA）
**结构**：
- 多个潜变量
- 各自加载到不同指标
- 潜变量之间允许协方差

**用途**：
- 区分效度
- 构念结构验证

---

### 5.3 二阶因子模型（Second-Order Factor）
**结构**：
- 二阶潜变量 → 一阶潜变量 → 指标

**用途**：
- 总因子 + 子维度
- 人格、能力结构

---

### 5.4 双因子模型（Bifactor Model）
**结构**：
- 一个 General factor
- 多个 Specific factors
- 指标同时加载在 General + Specific

**用途**：
- 方法效应
- 一般因子 vs 特异因子

---

### 5.5 结构回归模型（Basic SEM）
**结构**：
- 外生潜变量 → 内生潜变量
- 内生潜变量有扰动项 ζ

**用途**：
- 理论路径检验
- 假设驱动研究

---

### 5.6 中介模型（Mediation）
**结构**：
- X → M → Y
- 可包含 X → Y 直接路径

**用途**：
- 机制分析
- 间接效应检验

---

### 5.7 多重中介模型（Parallel / Serial）
**结构**：
- 并联中介：X → M1, M2 → Y
- 串联中介：X → M1 → M2 → Y

---

### 5.8 调节模型（Moderation / Interaction）
**结构**：
- X, Z → Y
- 或使用潜变量交互项 X×Z → Y

---

### 5.9 交叉滞后模型（CLPM）
**结构**：
- Y_t → Y_{t+1}
- X_t → Y_{t+1}
- 同时点残差相关

**用途**：
- 纵向因果推断

---

### 5.10 随机截距交叉滞后模型（RI-CLPM）
**结构**：
- 随机截距因子（Trait）
- 状态层面的交叉滞后

**用途**：
- 区分个体间 vs 个体内效应

---

### 5.11 潜增长模型（LGCM）
**结构**：
- i（截距） → 所有时间点
- s（斜率） → 时间权重

**用途**：
- 发展趋势
- 变化轨迹分析

---

### 5.12 多水平 SEM（MSEM）
**结构**：
- 个体水平模型
- 群体水平模型
- 同一变量在不同层次

---

### 5.13 DSEM / 动态 SEM
**结构**：
- 时间序列 + SEM
- 自回归 + 交叉滞后 + 随机效应

**用途**：
- 密集追踪数据
- EMA / ESM

---

### 5.14 测量不变性模型（MI）
**结构**：
- 配置不变
- 载荷不变
- 截距不变
- 残差不变

**用途**：
- 多组 / 多时间比较

---

## 6. 使用建议（给写论文 & 写插件的人）

- **论文**：  
  图只画“结构”，参数约束写在 caption 或方法中
- **教学/科普**：  
  推荐：每个 Prefab 单独一张图
- **VS Code / Mplus 插件**：  
  Prefab ≈ snippet / template  
  → 一键生成 CFA / CLPM / LGCM 框架

---

## 7. 一句话总结

> SEM 图 ≠ 装饰图  
> SEM 图是一种**可视化统计语言**  
> 而 Prefab Blocks = 这门语言的「语法模块」

